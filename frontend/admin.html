<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <nav>
            <div class="logo">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
            <a href="catalog.html">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥</a>
        </nav>
    </header>

    <main>

        <div class="category-card" onclick="window.location.href='users.html'" style="flex:1; text-align:center; padding:20px; border:1px solid #ddd; border-radius:8px; cursor:pointer;">
                    <h3>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏</p>
            </div>
        <div class="category-card" onclick="window.location.href='products_admin.html'" style="flex:1; text-align:center; padding:20px; border:1px solid #ddd; border-radius:8px; cursor:pointer; background-color:#fff3e0;">
                <h3>üì¶ –í—Å–µ —Ç–æ–≤–∞—Ä—ã</h3>
                <p>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å / –£–¥–∞–ª–∏—Ç—å</p>
        </div>

        
        <div class="category-card" onclick="window.location.href='add_product.html'" style="flex:1; text-align:center; padding:20px; border:1px solid #ddd; border-radius:8px; cursor:pointer; background-color:#e8f5e9;">
                <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
                <p>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π</p>
            </div>
        <h1>–ñ—É—Ä–Ω–∞–ª –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π </h1>
        <button onclick="clearLogs()" style="background:red; width:auto;">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>

        <br><br>
        <table>
            <thead>
                <tr>
                    <th>–í—Ä–µ–º—è</th>
                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                </tr>
            </thead>
            <tbody id="logsTable">
                <!-- JS –≤—Å—Ç–∞–≤–∏—Ç –ª–æ–≥–∏ -->
            </tbody>
        </table>
    </main>

    <script src="js/auth.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser || currentUser.role !== 'admin') {
            alert('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω! –ù—É–∂–Ω—ã –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.');
            window.location.href = 'index.html';
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ª–æ–≥–æ–≤ (–¢–ï–ü–ï–†–¨ –° –°–ï–†–í–ï–†–ê)
        async function renderLogs() {
            const tbody = document.getElementById('logsTable');
            tbody.innerHTML = '<tr><td colspan="3">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>';

            try {
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ª–æ–≥–∏ —É Python
                const response = await fetch('/logs');
                
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤');
                }

                const logs = await response.json();
                tbody.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
                
                if (logs.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3">–õ–æ–≥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</td></tr>';
                    return;
                }

                logs.forEach(log => {
                    const dateStr = log.timestamp ? new Date(log.timestamp).toLocaleString() : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                    tbody.innerHTML += `
                        <tr>
                            <td>${dateStr}</td>
                            <td>${log.user_login}</td>
                            <td>${log.action}</td>
                        </tr>
                    `;
                });

            } catch (error) {
                console.error(error);
                tbody.innerHTML = '<tr><td colspan="3" style="color:red;">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ª–æ–≥–∏</td></tr>';
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ (–ø–æ –∂–µ–ª–∞–Ω–∏—é, –ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É, 
        // —Ç–∞–∫ –∫–∞–∫ –≤ API –º—ã –Ω–µ –¥–µ–ª–∞–ª–∏ –º–µ—Ç–æ–¥ —É–¥–∞–ª–µ–Ω–∏—è, –Ω–æ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
        function clearLogs() {
            alert("–§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ —Ü–µ–ª—è—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.");
            renderLogs();
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        document.addEventListener('DOMContentLoaded', renderLogs);
    </script>
</body>
</html>