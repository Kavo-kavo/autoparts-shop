<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .admin-table { width: 100%; border-collapse: collapse; background: white; margin-top: 20px; }
        .admin-table th, .admin-table td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        .admin-table img { height: 50px; object-fit: contain; }
        
        .btn { padding: 5px 10px; text-decoration: none; color: white; border-radius: 4px; cursor: pointer; border: none; font-size: 14px; margin-right: 5px; }
        .edit-btn { background-color: #007bff; }
        .edit-btn:hover { background-color: #0056b3; }
        .del-btn { background-color: #dc3545; }
        .del-btn:hover { background-color: #a71d2a; }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
            <div id="nav-links">
                <a href="admin.html">–ù–∞–∑–∞–¥</a>
                <a href="add_product.html">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</a>
            </div>
            <div id="nav-auth"></div>
        </nav>
    </header>

    <main>
        <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h1>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–§–æ—Ç–æ</th>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–ë—Ä–µ–Ω–¥</th>
                    <th>–¶–µ–Ω–∞</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody id="productsTable">
                <!-- JS –≤—Å—Ç–∞–≤–∏—Ç —Ç–æ–≤–∞—Ä—ã -->
            </tbody>
        </table>
    </main>

    <script src="js/auth.js"></script>
    <script>
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser || currentUser.role !== 'admin') {
            window.location.href = 'index.html';
        }

        async function loadAdminProducts() {
            const response = await fetch('/products'); // –ë–µ—Ä–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã
            const products = await response.json();
            const tbody = document.getElementById('productsTable');
            tbody.innerHTML = '';

            products.forEach(p => {
                tbody.innerHTML += `
                    <tr>
                        <td>${p.id}</td>
                        <td><img src="${p.image_url}" alt="img"></td>
                        <td>${p.name}</td>
                        <td>${p.brand}</td>
                        <td>${p.price} ‚ÇΩ</td>
                        <td>
                            <button class="btn edit-btn" onclick="location.href='edit_product.html?id=${p.id}'">‚úèÔ∏è –†–µ–¥.</button>
                            <button class="btn del-btn" onclick="deleteProduct(${p.id})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });
        }

        async function deleteProduct(id) {
            if(confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?')) {
                await fetch(`/products/${id}`, { method: 'DELETE' });
                loadAdminProducts(); // –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É
                logAction(`–£–¥–∞–ª–∏–ª —Ç–æ–≤–∞—Ä ID: ${id}`);
            }
        }

        document.addEventListener('DOMContentLoaded', loadAdminProducts);
    </script>
</body>
</html>